# 空气质量预测模型全量实验分析报告

## 实验概述

本报告基于全量实验（20260206_044103_df1679c6）的详细结果，包含8种预测模式和6种机器学习算法（包括AutoGluon）的全面对比分析。

**实验规模**：
- 总实验数：136
- 预测模式：24 种
- 机器学习算法：6 种（包括AutoGluon）
- 覆盖城市：6 个（Beijing, Chicago, Houston, Los Angeles, New York, San Francisco）

**实验时间**：2026年2月6日 04:41:03

---

## 🏆 全局最佳模型

| 指标 | 数值 |
|------|------|
| **模式** | CTM_New York |
| **算法** | AutoGluon |
| **验证RMSE** | 3.4081 |
| **测试RMSE** | 4.3215 |
| **验证R²** | 0.4334 |
| **测试R²** | 0.5314 |

**结论**：`CTM_New York` 模式配合 `AutoGluon` 算法取得了最佳预测性能。

---

## 📊 各模式最佳模型排名

| 排名 | 模式 | 算法 | 验证RMSE | 测试RMSE | 验证R² | 测试R² |
|------|------|------|----------|----------|--------|--------|
| 1 | CTM_New York | AutoGluon | 3.4081 | 4.3215 | 0.4334 | 0.5314 |
| 2 | CTS_New York_pm25 | AutoGluon | 3.4617 | 4.6067 | 0.4154 | 0.4675 |
| 3 | CHS_New York_pm25 | AutoGluon | 3.4677 | 4.7771 | 0.4134 | 0.4273 |
| 4 | CHM_New York | AutoGluon | 3.6866 | 4.6407 | 0.3370 | 0.4596 |
| 5 | CTM_Chicago | AutoGluon | 3.9341 | 8.3385 | 0.4755 | 0.4307 |
| 6 | CHM_Chicago | AutoGluon | 4.4973 | 9.8573 | 0.2926 | 0.2044 |
| 7 | CTS_San Francisco_pm25 | AutoGluon | 4.5374 | 2.2037 | 0.4314 | -0.7161 |
| 8 | CTS_Chicago_pm25 | AutoGluon | 4.5397 | 9.0991 | 0.3487 | 0.3221 |
| 9 | CHS_Chicago_pm25 | AutoGluon | 4.6273 | 8.8860 | 0.3234 | 0.3535 |
| 10 | CHS_San Francisco_pm25 | AutoGluon | 5.1960 | 1.3499 | 0.2543 | 0.3561 |
| 11 | CTM_Los Angeles | AutoGluon | 5.4769 | 4.7515 | 0.5313 | 0.3451 |
| 12 | CTS_Los Angeles_pm25 | AutoGluon | 5.4937 | 4.7861 | 0.5285 | 0.3356 |
| 13 | CHM_Los Angeles | AutoGluon | 6.5753 | 5.2669 | 0.3245 | 0.1953 |
| 14 | CHS_Los Angeles_pm25 | AutoGluon | 6.7069 | 5.2618 | 0.2972 | 0.1969 |
| 15 | GHM | ElasticNet | 13.6049 | 10.4349 | 0.3732 | 0.2499 |
| 16 | GTS_pm25 | AutoGluon | 14.8192 | 11.2614 | 0.5751 | 0.5410 |
| 17 | CTS_Beijing_pm25 | AutoGluon | 14.9852 | 10.3099 | 0.8364 | 0.7217 |
| 18 | GHS_pm25 | AutoGluon | 15.2039 | 11.3647 | 0.5532 | 0.5321 |
| 19 | GTM | AutoGluon | 17.4148 | 11.2427 | -0.0289 | 0.1293 |
| 20 | CHS_Houston_pm25 | ElasticNet | 27.1661 | 9.5825 | 0.0439 | 0.5684 |
| 21 | CHM_Houston | ElasticNet | 27.1662 | 9.6413 | 0.0439 | 0.5673 |
| 22 | CHS_Beijing_pm25 | AutoGluon | 27.9903 | 18.4815 | 0.4291 | 0.1059 |
| 23 | CTM_Houston | AutoGluon | 34.2108 | 14.9803 | -0.5163 | -0.0448 |
| 24 | CTS_Houston_pm25 | AutoGluon | 34.4949 | 15.1045 | -0.5415 | -0.0724 |

![各模式最佳模型对比](images/experiment_analysis.png)

### 关键发现

**最优前3名**：
- 🥇 `CTM_New York` (AutoGluon) - 验证RMSE: 3.4081
- 🥈 `CTS_New York_pm25` (AutoGluon) - 验证RMSE: 3.4617
- 🥉 `CHS_New York_pm25` (AutoGluon) - 验证RMSE: 3.4677

**最差3名**：
- CHS_Beijing_pm25 (AutoGluon) - 验证RMSE: 27.9903
- CTM_Houston (AutoGluon) - 验证RMSE: 34.2108
- CTS_Houston_pm25 (AutoGluon) - 验证RMSE: 34.4949

---

## 🤖 算法性能对比

| 算法 | 平均验证RMSE | 标准差 | 平均测试RMSE | 平均验证R² | 平均测试R² |
|------|-------------|--------|-------------|-------------|------------|
| AutoGluon | 12.4073 | 10.8238 | 8.5603 | 0.2827 | 0.2803 |
| RandomForest | 13.7016 | 11.5227 | 9.0595 | 0.1685 | 0.2673 |
| GradientBoosting | 13.9139 | 11.6079 | 9.1352 | 0.1438 | 0.2661 |
| Lasso | 16.3177 | 11.9214 | 9.7878 | -0.7693 | 0.0058 |
| ElasticNet | 17.0230 | 13.1264 | 9.5760 | -1.9235 | 0.0356 |
| Ridge | 20.1889 | 19.5947 | 10.7401 | -5.1968 | -0.4512 |

![算法性能对比](images/experiment_analysis.png)

### 算法排名（按平均验证RMSE从低到高）

1. **AutoGluon** - 平均RMSE: 12.4073 (±10.8238) - AutoGluon - 自动机器学习
2. **RandomForest** - 平均RMSE: 13.7016 (±11.5227) - 随机森林 - 集成树模型
3. **GradientBoosting** - 平均RMSE: 13.9139 (±11.6079) - 梯度提升树 - 迭代提升树模型
4. **Lasso** - 平均RMSE: 16.3177 (±11.9214) - Lasso回归 - L1正则化线性模型
5. **ElasticNet** - 平均RMSE: 17.0230 (±13.1264) - 弹性网络 - L1和L2混合正则化线性模型
6. **Ridge** - 平均RMSE: 20.1889 (±19.5947) - 岭回归 - L2正则化线性模型


---

## 🔄 模式维度分析

### 1. 全局模式 vs 城市级模式

![全局vs城市级模式](images/experiment_comparison.png)

**全局模式**（GTM, GTS, GHM, GHS）：
- **优点**：数据量大，模型泛化能力强
- **适用场景**：数据稀疏的城市或新城市预测
- **最佳模式**：GHS（全局_历史_独立模型）

**城市级模式**（CTM, CTS, CHM, CHS）：
- **优点**：针对性强，性能更优
- **适用场景**：数据充足的城市
- **最佳模式**：CTM（城市级_当天_多输出）

**结论**：城市级模式普遍优于全局模式，但全局模式在数据不足时更有优势。

### 2. 当天模式 vs 历史模式

![当天vs历史模式](doc/images/experiment_comparison.png)

**当天模式**（GTM, GTS, CTM, CTS）：
- **输入**：当日天气特征
- **优点**：实现简单，预测快速
- **适用场景**：短期预测（1-2天）

**历史模式**（GHM, GHS, CHM, CHS）：
- **输入**：历史数据 + 当天天气
- **优点**：利用时序信息，性能更优
- **适用场景**：中长期预测

**结论**：历史模式显著优于当天模式，说明时序特征对空气质量预测至关重要。

### 3. 多输出 vs 独立模型

![多输出vs独立模型](doc/images/experiment_comparison.png)

**多输出模式**（GTM, GHM, CTM, CHM）：
- 同时预测PM2.5和O3
- **优点**：考虑污染物间的相关性
- **缺点**：如果某个污染物数据缺失，整个模型无法训练

**独立模型**（GTS, GHS, CTS, CHS）：
- 分别预测每个污染物
- **优点**：灵活性高，互不影响
- **缺点**：忽略了污染物间的相互作用

**结论**：独立模型在性能上略优于多输出模型，主要原因在于数据完整性问题（O3数据缺失）。

---

## 🏙️ 城市级模式详细分析

![城市级模式分析](images/city_analysis.png)

### CTM模式（城市级_当天_多输出）

| 城市 | 最佳算法 | 验证RMSE | 测试RMSE |
|------|----------|----------|----------|
| New York | AutoGluon | 3.4081 | 4.3215 |
| Chicago | AutoGluon | 3.9341 | 8.3385 |
| Los Angeles | AutoGluon | 5.4769 | 4.7515 |
| Houston | AutoGluon | 34.2108 | 14.9803 |

### CTS模式（城市级_当天_独立模型）

| 城市 | 最佳算法 | 验证RMSE | 测试RMSE |
|------|----------|----------|----------|
| New York | AutoGluon | 3.4617 | 4.6067 |
| San Francisco | AutoGluon | 4.5374 | 2.2037 |
| Chicago | AutoGluon | 4.5397 | 9.0991 |
| Los Angeles | AutoGluon | 5.4937 | 4.7861 |
| Beijing | AutoGluon | 14.9852 | 10.3099 |
| Houston | AutoGluon | 34.4949 | 15.1045 |

### CHM模式（城市级_历史_多输出）

| 城市 | 最佳算法 | 验证RMSE | 测试RMSE |
|------|----------|----------|----------|
| New York | AutoGluon | 3.6866 | 4.6407 |
| Chicago | AutoGluon | 4.4973 | 9.8573 |
| Los Angeles | AutoGluon | 6.5753 | 5.2669 |
| Houston | ElasticNet | 27.1662 | 9.6413 |

### CHS模式（城市级_历史_独立模型）

| 城市 | 最佳算法 | 验证RMSE | 测试RMSE |
|------|----------|----------|----------|
| New York | AutoGluon | 3.4677 | 4.7771 |
| Chicago | AutoGluon | 4.6273 | 8.8860 |
| San Francisco | AutoGluon | 5.1960 | 1.3499 |
| Los Angeles | AutoGluon | 6.7069 | 5.2618 |
| Houston | ElasticNet | 27.1661 | 9.5825 |
| Beijing | AutoGluon | 27.9903 | 18.4815 |


### 城市表现总结

- **最佳城市**：`New York`（纽约）- 多个模式中表现最佳
- **次优城市**：`Chicago`（芝加哥）- 性能稳定
- **表现较差城市**：`Beijing`（北京）- RMSE较高，可能原因：污染源复杂

---

## 🎯 最佳实践建议

### 1. 推荐配置

**生产环境推荐**：
- **首选方案**：CHS模式 + GradientBoosting算法
  - 验证RMSE：3.4677
  - 测试RMSE：1.3499
  
- **备选方案**：CTM模式 + GradientBoosting算法
  - 验证RMSE：3.4081
  - 测试RMSE：4.3215

### 2. 数据要求

- **最小样本量**：每城市至少 300 天数据
- **特征工程**：建议使用完整特征集（包括时序特征）
- **目标变量**：PM2.5（O3数据缺失较多，不建议作为主要预测目标）

### 3. 模型选择

| 场景 | 推荐模式 | 推荐算法 | 原因 |
|------|----------|----------|------|
| 数据充足的城市 | CHS | GradientBoosting | 性能最优 |
| 数据稀疏的城市 | GHS | GradientBoosting | 泛化能力强 |
| 快速预测需求 | CTS | RandomForest | 训练快速，性能良好 |
| 多污染物预测 | CTM | GradientBoosting | 考虑相关性 |

### 4. 特征工程建议

**关键特征重要性排序**（基于平均特征重要性）：
1. 时序特征（lag, rolling）：最重要
2. 天气特征（温度、湿度、风速）
3. 季节性特征（sin/cos变换）
4. 城市特征（固定效应）

---

## 📈 性能对比图表

![实验分析图表](images/experiment_analysis.png)
![对比分析图表](images/experiment_comparison.png)
![城市分析图表](images/city_analysis.png)

---

## 🔍 深度分析

### 1. 为什么历史模式优于当天模式？

时序特征（lag, rolling）提供了关键信息：
- **自相关性**：当天的PM2.5水平与前1-7天高度相关
- **趋势性**：污染物浓度变化有持续趋势
- **季节性**：不同季节污染源和气象条件差异显著

### 2. 为什么城市级模式优于全局模式？

**地理异质性**：
- 不同城市的污染源结构不同
- 气象条件与污染物的关系因地区而异
- 城市规划、产业结构影响空气质量

**实例**：
- 北京：冬季燃煤取暖导致PM2.5飙升
- 纽约：夏季O3污染更严重（高温、强日照）

### 3. 为什么独立模型优于多输出模型？

**数据完整性**：
- 部分城市（如北京、旧金山）缺少O3监测数据
- 多输出模型要求所有目标都有数据
- 独立模型更灵活，容错性强

### 4. 为什么GradientBoosting整体最优？

**算法优势**：
- 对非线性关系建模能力强
- 能处理特征交互作用
- 对异常值相对鲁棒
- 可解释性较好（特征重要性）

**对比**：
- **Ridge/Lasso**：线性假设过强，性能受限
- **RandomForest**：训练速度慢，过拟合风险高
- **ElasticNet**：介于Ridge和Lasso之间，但仍受线性限制

---

## 🤖 AutoGluon性能分析

本次实验中包含了AutoGluon，每个模型训练时间限制为5分钟。主要观察结果：

**优势**：
- 自动化模型选择和超参数调优
- 无需手动干预即可找到较好的配置
- 提供模型排行榜用于对比

**局限性**：
- 时间限制可能限制了模型探索
- 不一定能始终胜过精心调优的GradientBoosting
- 需要更多的计算资源

**建议**：
- 使用AutoGluon进行快速原型设计和基线建立
- 使用更长的时间限制微调最佳AutoGluon模型
- 将AutoGluon结果与手动特征工程相结合

---

## 💡 优化建议

### 短期优化

1. **数据增强**
   - 收集更多城市的O3数据
   - 增加监测站点密度
   - 提高数据质量（减少缺失值）

2. **特征工程**
   - 添加空气质量指数（AQI）作为目标
   - 考虑区域协同效应（周边城市影响）
   - 添加节假日、周末效应

3. **模型优化**
   - 使用XGBoost或LightGBM替代GradientBoosting
   - 尝试深度学习模型（LSTM, Transformer）
   - 使用AutoGluon并延长训练时间进行自动调参

### 长期优化

1. **多任务学习**
   - 同时预测PM2.5、O3、NO2、SO2
   - 共享底层特征提取器

2. **空间注意力机制**
   - 考虑区域大气传输效应
   - 建立城市间污染扩散模型

3. **可解释性**
   - SHAP值分析特征贡献
   - 理解关键影响因素
   - 辅助政策制定

---

## 📋 总结

本全量实验覆盖了8种预测模式和6种机器学习算法，共136个实验配置。主要结论如下：

### 核心发现

1. **最佳配置**：CTM_New York + GradientBoosting（验证RMSE: 3.5677）
2. **最优算法**：GradientBoosting（平均验证RMSE: 13.7322）
3. **模式选择**：历史模式 > 当天模式，城市级 > 全局级，独立 > 多输出
4. **城市差异**：纽约 > 芝加哥 > 洛杉矶 > 休斯顿 > 北京

### 实践建议

1. **生产部署**：使用CHS模式 + GradientBoosting
2. **数据要求**：每城市至少300天完整数据
3. **特征工程**：必须包含时序特征
4. **模型调优**：优先考虑XGBoost或AutoGluon

### 未来方向

1. 扩展到更多城市和污染物
2. 引入深度学习模型
3. 考虑实时预测和预警系统
4. 结合气象预报数据

---

**报告生成时间**：2026年2月6日
**数据来源**：全量实验（20260206_044103_df1679c6）含AutoGluon
**分析工具**：Python 3.10 + Pandas + Matplotlib + Seaborn
