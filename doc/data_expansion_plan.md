# 数据集扩展计划

## 一、当前问题诊断

### 问题现象
从训练日志观察到 O3/NO2 数据异常：
```
O3: RMSE=0.00
NO2: RMSE=0.00
```

### 数据清理记录
```
数据清理: 训练集 4386 -> 1637（损失 62%）
```
这表明 62.7% 的样本因 O3/NO2 缺失被丢弃。

### 可能原因
1. **缺失值太多**：多污染物实验时样本数大幅减少
2. **浓度范围小**：O3/NO2 单位为 ppb，数值范围比 PM2.5（μg/m³）小很多
3. **监测不完整**：某些城市可能没有监测 O3/NO2

---

## 二、增加城市的建议

### 日本城市（4-6个）

| 城市 | 原因 | 污染特征 |
|------|------|----------|
| **东京** | 首都，数据质量高 | PM2.5中等，O3夏季高 |
| **大阪** | 工业城市 | PM2.5较高，工业排放 |
| **名古屋** | 汽车工业中心 | NO2较高（交通） |
| **福冈** | 海洋性气候 | PM2.5较低，对比基准 |
| **横滨** | 港口城市 | SO2较高（航运） |

### 印度城市（4-6个）

| 城市 | 原因 | 污染特征 |
|------|------|----------|
| **德里** | 最严重污染城市 | PM2.5常>200，极端案例 |
| **孟买** | 沿海大城市 | PM2.5中等，季节性强 |
| **班加罗尔** | 科技城市 | PM2.5较低，对比基准 |
| **加尔各答** | 工业港口 | PM2.5高，工业排放 |
| **金奈** | 热带沿海 | PM2.5中等，气候独特 |

### 欧洲城市（3-4个，可选）

| 城市 | 原因 | 污染特征 |
|------|------|----------|
| **伦敦** | 欧洲首都，政策严格 | PM2.5低，治理效果好 |
| **巴黎** | 交通密集 | NO2较高 |
| **柏林** | 工业历史 | SO2较高 |

### 南半球城市（4-6个，强烈推荐）

**添加南半球城市的必要性**：
- **消除季节偏差**：当前6个城市全部在北半球，模型可能错误学习"月份=季节"的简单关联
- **强制学习物理机制**：模型必须理解"温度高+阳光强=O3高"而非"6-8月=夏季"
- **提升全球泛化能力**：支持南北半球预测
- **增强鲁棒性**：提供极端污染案例（如堪培拉野火）

#### 澳大利亚城市（3个）

| 城市 | 原因 | 污染特征 | 数据质量 |
|------|------|----------|----------|
| **悉尼** | 最大城市，数据完整 | PM2.5中等，野火影响 | ★★★★★ |
| **堪培拉** | 首都，野火影响大 | PM2.5极高（野火季可达1000+） | ★★★★★ |
| **墨尔本** | 工业港口 | PM2.5中等，工业排放 | ★★★★☆ |

**堪培拉的价值**：
- 2019-2020年澳洲山火，PM2.5达 1000+ μg/m³
- 极端污染案例，提升模型对异常情况的鲁棒性
- 与德里（印度）形成对比（两种极端污染源）

#### 南美洲城市（1-2个）

| 城市 | 原因 | 污染特征 | 数据质量 |
|------|------|----------|----------|
| **圣保罗** | 最大城市 | PM2.5高，交通污染 | ★★★★☆ |
| **布宜诺斯艾利斯** | 首都，港口 | PM2.5中等，SO2高 | ★★★☆☆ |

#### 南非城市（1个）

| 城市 | 原因 | 污染特征 | 数据质量 |
|------|------|----------|----------|
| **开普敦** | 监测完善 | PM2.5低，对比基准 | ★★★★☆ |

---

## 三、季节平衡策略

### 当前问题
```
当前6个城市：全部在北半球
- 北京、纽约、芝加哥、休斯顿、洛杉矶、旧金山
```

**季节性污染模式差异**：
| 月份 | 北半球 | 南半球 | 污染特征 |
|------|--------|--------|----------|
| 6-8月 | 夏季 | 冬季 | O3高（北），取暖污染（南） |
| 12-2月 | 冬季 | 夏季 | 取暖污染（北），O3高（南） |

### 目标配置
```
北半球城市：6个（当前）
南半球城市：4-6个（新增）
```

**具体分配**：
- 澳大利亚：3个（悉尼、堪培拉、墨尔本）
- 南美洲：1-2个（圣保罗、布宜诺斯艾利斯）
- 南非：1个（开普敦）

### 预期改善
- **季节平衡**：从 0% → 40-50%
- **物理正确性**：模型必须学习真正的环境-污染关联
- **极端案例**：+2个（堪培拉野火、德里重度污染）

---

## 四、年份扩充建议

### 当前数据
- 范围：3年（假设 2021-2023）
- 样本数：6城市 × 3年 × 365天 = 6,570 样本/城市

### 推荐扩充
- **年份范围**：5-8年（2016-2023 或 2017-2024）

### 理由
1. **季节性模式**：至少需要 5 年才能稳定捕捉
2. **极端事件**：2019年澳洲山火、2020年疫情封锁
3. **政策变化**：各国排放标准调整周期
4. **气候周期**：厄尔尼诺/拉尼娜周期（3-7年）

### 数据量估算
```
当前：6城市 × 3年 × 365天 = 6,570 样本

新方案（日本6 + 印度6 + 南半球4-6 + 当前6 = 22-24城市）：
- 22城市 × 5年 × 365天 = 40,150 样本
- 24城市 × 8年 × 365天 = 70,080 样本

增幅：6-11倍
```

**南半球贡献**：
- 增加 4-6 个南半球城市
- 样本数增加：7,300-10,950
- 季节平衡：从 0% → 40-50%

---

## 五、数据质量优先级

### 必须验证的指标

#### 1. 污染物监测完整性
目标城市必须包含以下全部污染物：
- PM2.5（μg/m³）
- PM10（μg/m³）
- O3（ppb 或 μg/m³）
- NO2（ppb 或 μg/m³）
- SO2（ppb 或 μg/m³）
- CO（ppm 或 mg/m³）

**拒绝标准**：缺失 >30% 的城市

#### 2. 数据连续性
- **理想**：每周至少 6 天有数据
- **可接受**：每月至少 20 天有数据
- **拒绝**：连续缺失 >7 天

#### 3. 时间覆盖
- **理想**：至少覆盖 5 年
- **可接受**：至少覆盖 3 年
- **拒绝**：覆盖 <2 年

---

## 六、具体实施路线图

### 阶段1：数据收集评估（1-2周）

**任务**：
1. 从 OpenAQ API 查询目标城市数据覆盖情况
2. 统计每个城市的：
   - 可用年份
   - 每种污染物的完整度
   - 缺失值比例

**输出**：城市质量评分表（0-10分）
- ≥8分：优先添加
- 5-7分：备选
- <5分：拒绝

### 阶段2：首批城市添加（1周）

**目标**：先添加 4-6 个高质量城市

**推荐顺序**：
1. 东京（数据质量高，基准城市）
2. 德里（极端污染案例）
3. 大阪（工业污染）
4. 孟买（沿海对比）
5. 加尔各答（极端案例）

**预期**：
- 城市数：6 → 10
- 样本数：6,570 → 10,950（+67%）
- 多污染物可用样本：1,637 → 2,500（+53%）

### 阶段3：年份扩充（1周）

**任务**：
1. 拉取现有 6 城市的 2016-2017 数据
2. 拉取新 4 城市的 2016-2024 数据

**预期**：
- 年份范围：3年 → 8年
- 样本数：10,950 → 29,200（+167%）
- 多污染物可用样本：2,500 → 6,700（+168%）

### 阶段4：第二轮城市添加（1-2周）

**目标**：再添加 4-6 个城市（包含南半球）

**推荐**：
1. 名古屋（日本，NO2高）
2. 福冈（日本，海洋性气候）
3. 班加罗尔（印度，清洁基准）
4. **悉尼**（澳大利亚，南半球基准）★★★
5. **堪培拉**（澳大利亚，野火极端案例）★★★

**预期**：
- 城市数：10 → 15
- 样本数：29,200 → 43,800（+50%）
- 南半球比例：0% → 27%（3/11）

### 阶段5：南半球城市补充（1周）

**目标**：添加更多南半球城市，增强季节平衡

**推荐**：
1. **墨尔本**（澳大利亚，工业对比）
2. **圣保罗**（南美洲，最大南半球城市）
3. **开普敦**（南非，清洁基准）

**预期**：
- 城市数：15 → 18
- 样本数：43,800 → 52,560（+20%）
- 南半球比例：27% → 44%（7/16）
- 季节平衡：显著改善

---

## 七、污染物数据改善策略

### 针对性解决 O3/NO2 数据问题

#### 1. O3（臭氧）数据增强

**优先添加的城市特征**：
- 夏季 O3 浓度高（如德里、东京）
- 海拔较高（紫外线强，O3形成快）
- 交通密集（NOx + 阳光 → O3）

**推荐城市**：
- 德里（热带，夏季O3高）
- 东京（监测完善，O3数据好）
- 洛杉矶（已存在，夏季O3高）

#### 2. NO2（二氧化氮）数据增强

**优先添加的城市特征**：
- 交通密度高（汽车、港口）
- 工业城市（电厂、工厂）

**推荐城市**：
- 名古屋（汽车工业中心）
- 横滨（港口城市）
- 加尔各答（工业港口）

#### 3. SO2（二氧化硫）数据增强

**优先添加的城市特征**：
- 重工业城市
- 燃煤电厂
- 港口城市（船舶排放）

**推荐城市**：
- 大阪（工业城市）
- 横滨（港口）
- 加尔各答（工业）

#### 4. CO（一氧化碳）数据增强

**优先添加的城市特征**：
- 交通拥堵城市
- 寒冷地区（冬季取暖）

**推荐城市**：
- 德里（交通+冬季）
- 北京（已存在，冬季CO高）
- 莫斯科（可选，冬季取暖）

#### 5. 极端污染案例数据增强

**堪培拉野火（2019-2020）**：
- PM2.5峰值：1000+ μg/m³（正常城市的 5-10 倍）
- 持续时间：数周
- 特征：烟雾传输、温度异常、能见度极低

**价值**：
- 与德里（工业污染）形成对比
- 提升模型对极端污染的鲁棒性
- 支持极端事件预警

**推荐城市**：
- 堪培拉（野火案例）★★★
- 悉尼（野火影响，次级案例）

---

## 八、预期效果评估

### 数据量改善

| 指标 | 当前 | 阶段1 | 阶段2 | 阶段3 | 阶段4 | 阶段5 |
|------|------|-------|-------|-------|-------|-------|
| 城市数 | 6 | 10 | 10 | 15 | 18 | 22-24 |
| 年份范围 | 3年 | 3年 | 8年 | 8年 | 8年 | 8年 |
| 北半球城市 | 6 | 10 | 10 | 12 | 11 | 15-16 |
| 南半球城市 | 0 | 0 | 0 | 3 | 7 | 7-8 |
| 南半球比例 | 0% | 0% | 0% | 20% | 39% | 32-35% |
| 总样本数 | 6,570 | 10,950 | 29,200 | 43,800 | 52,560 | 64,240-70,080 |
| 多污染物样本 | 1,637 | 2,500 | 6,700 | 10,000 | 12,000 | 14,500-16,000 |
| 增幅 | - | +67% | +344% | +567% | +700% | +878-966% |

### 模型性能预期

#### PM2.5 预测
```
当前 RMSE：1.91（GHS）
预期 RMSE：1.4-1.7（提升 11-27%）
原因：更多城市 → 更好的泛化能力
```

#### O3/NO2 预测
```
当前 RMSE：0.00（异常）
预期 RMSE：0.4-1.2（正常范围）
原因：样本数从 1,637 → 14,500-16,000（+786-877%）
```

#### 季节平衡改善
```
当前：仅北半球，季节偏差大
预期：南北半球平衡，模型物理正确性显著提升
- 模型必须学习"温度高+阳光强=O3高"而非"6-8月=夏季"
- 支持全球范围预测
```

#### 多任务学习效果
```
当前提升：GHM vs GHS = 12.6%
预期提升：18-25%
原因：更多污染物数据 → 更好的协同学习
```

#### 极端污染案例
```
新增极端案例：
- 堪培拉：野火 PM2.5达 1000+ μg/m³
- 德里：工业污染 PM2.5常>200 μg/m³
预期：模型对极端污染的鲁棒性显著提升
```

---

## 九、风险与注意事项

### 潜在问题

#### 1. 数据不一致性

**问题**：不同国家监测标准不同
- 单位：ppb vs μg/m³ vs ppm
- 时间分辨率：小时 vs 日
- 质量控制标准不同

**解决**：统一转换到 μg/m³，统一到日均值

#### 2. 气候差异

**问题**：热带（印度） vs 温带（日本）差异大
- 污染形成机制不同
- 模型可能学到"气候标签"而非污染机制

**解决**：添加气候特征（温度范围、湿度范围）

#### 3. 城市特异性

**问题**：某些城市污染源独特（如德里的垃圾焚烧）
- 模型过拟合到特定城市
- 泛化能力下降

**解决**：增加城市数，交叉验证

#### 4. 南半球数据质量

**问题**：南半球城市监测站可能较少，数据质量参差不齐
- 某些城市监测覆盖率低
- 数据连续性可能不如北半球

**解决**：
- 优先选择澳大利亚（数据质量最高）
- 严格数据质量检查（缺失率<30%）
- 分层验证：先测试澳大利亚数据质量

### 质量保证措施

#### 1. 数据验证检查点
```python
# 每个新城市必须通过以下检查
def validate_city_data(df):
    checks = {
        "污染物完整度": check_pollutant_completeness(df),
        "缺失值比例": check_missing_rate(df),
        "连续性": check_data_continuity(df),
        "异常值": check_outliers(df),
    }
    return all(checks.values())
```

#### 2. 分阶段训练
```
阶段1：用当前 6 城市训练基线
阶段2：加入日本 4 城市，验证泛化
阶段3：加入印度 4 城市，验证极端情况
阶段4：加入澳大利亚 3 城市，验证季节平衡 ★★★
阶段5：加入南美洲/南非 2-3 城市，验证全球泛化
```

---

## 十、最终建议

### 推荐方案

#### 城市选择
1. **日本（6个）**：东京、大阪、名古屋、福冈、横滨、神户
2. **印度（6个）**：德里、孟买、班加罗尔、加尔各答、金奈、海德拉巴
3. **澳大利亚（3个）**：悉尼、堪培拉、墨尔本 ★★★（强烈推荐）
4. **南美洲（1-2个）**：圣保罗、布宜诺斯艾利斯
5. **南非（1个）**：开普敦
6. **欧洲（3个，可选）**：伦敦、巴黎、柏林

#### 年份范围
**2016-2024（8年）**

#### 预期收益
- 数据量：+878-966%
- 多污染物样本：+786-877%
- 南半球比例：32-35%
- 季节平衡：显著改善
- PM2.5 RMSE：改善 11-27%
- O3/NO2 RMSE：从异常恢复到正常范围

### 执行优先级

#### 第一优先级（必须）
1. 东京（数据质量高，基准城市）
2. 德里（极端污染案例）
3. **悉尼**（南半球基准）★★★
4. **堪培拉**（野火极端案例）★★★
5. 年份扩充至 8 年

#### 第二优先级（推荐）
6. 大阪、孟买、加尔各答
7. **墨尔本**（澳大利亚，工业对比）
8. **圣保罗**（南美洲，最大南半球城市）

#### 第三优先级（可选）
9. 其他印度/日本城市
10. **开普敦**（南非，清洁基准）
11. **布宜诺斯艾利斯**（阿根廷，港口对比）
12. 欧洲城市
13. 年份扩充至 10 年（如果需要）

---

## 十一、总结

### 方案合理性
- ✅ 增加日本和印度城市是明智选择（提供多样性和极端案例）
- ✅ **添加南半球城市是强烈推荐**（消除季节偏差，提升物理正确性）
- ✅ 扩充到 5 年以上是必要的（捕捉季节性和年际变化）
- ✅ 预期将显著改善 O3/NO2 的预测性能

### 建议
- **必须添加**：东京、德里、悉尼、堪培拉（包含南半球城市）
- 年份扩充至 8 年（2016-2024）
- 验证 O3/NO2 数据恢复正常后，再考虑进一步扩充
- 目标南半球比例：30-40%

### 核心目标
通过数据集扩展，实现：
1. 解决 O3/NO2 数据不足问题
2. **消除季节偏差**（南北半球平衡）
3. **提升模型物理正确性**（学习真正的环境-污染关联）
4. 提升模型泛化能力
5. 支持神经网络训练（达到 50k+ 样本）
6. 捕捉极端污染案例（堪培拉野火、德里重度污染）
2. 提升模型泛化能力
3. 支持神经网络训练（达到 50k+ 样本）
4. 捕捉极端污染案例（如德里）